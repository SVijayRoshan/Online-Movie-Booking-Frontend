import{c as K,r as n,h as M,i as O,j as e,k as Q,P as q,l as Y,m as $,a as I,n as G,d as W,e as X,g as J,q as V,f as Z}from"./index-YhsNIgvP.js";import{u as ee,H as B}from"./Header-CL76FjJX.js";import{u as te}from"./useMutation-CLwU4-RE.js";import{a as R,B as T}from"./button-Duyd6bEY.js";import{P as se}from"./ProtectedRoute-BkExmAMJ.js";import{C}from"./card-CfP9Vloi.js";import{I as P}from"./input-BxC0n9rW.js";import{L as N}from"./label-BgjeurpF.js";import{u as ae}from"./index-Bwx7h8AJ.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=K("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);var k="Switch",[ie]=Q(k),[re,oe]=ie(k),F=n.forwardRef((i,o)=>{const{__scopeSwitch:t,name:c,checked:r,defaultChecked:l,required:h,disabled:d,value:x="on",onCheckedChange:g,form:m,...v}=i,[f,b]=n.useState(null),u=M(o,p=>b(p)),y=n.useRef(!1),a=f?m||!!f.closest("form"):!0,[j,w]=O({prop:r,defaultProp:l??!1,onChange:g,caller:k});return e.jsxs(re,{scope:t,checked:j,disabled:d,children:[e.jsx(q.button,{type:"button",role:"switch","aria-checked":j,"aria-required":h,"data-state":H(j),"data-disabled":d?"":void 0,disabled:d,value:x,...v,ref:u,onClick:Y(i.onClick,p=>{w(S=>!S),a&&(y.current=p.isPropagationStopped(),y.current||p.stopPropagation())})}),a&&e.jsx(D,{control:f,bubbles:!y.current,name:c,value:x,checked:j,required:h,disabled:d,form:m,style:{transform:"translateX(-100%)"}})]})});F.displayName=k;var L="SwitchThumb",_=n.forwardRef((i,o)=>{const{__scopeSwitch:t,...c}=i,r=oe(L,t);return e.jsx(q.span,{"data-state":H(r.checked),"data-disabled":r.disabled?"":void 0,...c,ref:o})});_.displayName=L;var ce="SwitchBubbleInput",D=n.forwardRef(({__scopeSwitch:i,control:o,checked:t,bubbles:c=!0,...r},l)=>{const h=n.useRef(null),d=M(h,l),x=ae(t),g=$(o);return n.useEffect(()=>{const m=h.current;if(!m)return;const v=window.HTMLInputElement.prototype,b=Object.getOwnPropertyDescriptor(v,"checked").set;if(x!==t&&b){const u=new Event("click",{bubbles:c});b.call(m,t),m.dispatchEvent(u)}},[x,t,c]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:t,...r,tabIndex:-1,ref:d,style:{...r.style,...g,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});D.displayName=ce;function H(i){return i?"checked":"unchecked"}var z=F,de=_;const A=n.forwardRef(({className:i,...o},t)=>e.jsx(z,{className:I("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",i),...o,ref:t,children:e.jsx(de,{className:I("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));A.displayName=z.displayName;function le(){var E;const i=G(),[,o]=W(),{user:t}=X(),{toast:c}=J(),r=new URLSearchParams(i),l=r.get("showId"),h=r.get("lockToken"),d=((E=r.get("seats"))==null?void 0:E.split(","))||[],[x,g]=n.useState((t==null?void 0:t.name)||""),[m,v]=n.useState((t==null?void 0:t.email)||""),[f,b]=n.useState(""),[u,y]=n.useState("success"),{data:a}=ee({queryKey:["/api/shows",l],queryFn:()=>R.getShow(l),enabled:!!l}),j=(a==null?void 0:a.seatsLayout.filter(s=>d.includes(s.id)))||[],w=j.reduce((s,U)=>s+U.price,0),p=te({mutationFn:()=>{if(u==="fail")throw new Error("Payment failed. Please try again.");return R.createBooking({userId:t.id,showId:l,seatIds:d,lockToken:h})},onSuccess:s=>{V.invalidateQueries({queryKey:["/api/bookings"]}),c({title:"Booking confirmed!",description:`Your booking ID is ${s.id}`}),o("/profile")},onError:s=>{c({title:"Booking failed",description:s.message,variant:"destructive"})}}),S=s=>{if(s.preventDefault(),!x||!m||!f){c({title:"Missing information",description:"Please fill in all fields",variant:"destructive"});return}p.mutate()};return!l||!h||d.length===0?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(B,{}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-12 text-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Invalid checkout session"}),e.jsx(T,{onClick:()=>o("/"),className:"mt-4",children:"Go Home"})]})]}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(B,{}),e.jsxs("main",{className:"max-w-5xl mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-8",children:"Checkout"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsxs(C,{className:"p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Booking Summary"}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Theatre"}),e.jsx("span",{className:"font-medium","data-testid":"text-theatre",children:a==null?void 0:a.theatre})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Date"}),e.jsx("span",{className:"font-medium","data-testid":"text-date",children:a!=null&&a.date?new Date(a.date).toLocaleDateString():""})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Time"}),e.jsx("span",{className:"font-medium","data-testid":"text-time",children:a==null?void 0:a.time})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Seats"}),e.jsx("span",{className:"font-medium","data-testid":"text-seats",children:j.map(s=>s.id).join(", ")})]}),e.jsxs("div",{className:"border-t pt-3 mt-3 flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{"data-testid":"text-total",children:Z(w)})]})]})]}),e.jsxs(C,{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Payment Simulation"}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs(N,{htmlFor:"payment-mode",className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:"Payment Mode"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Toggle to simulate ",u==="success"?"failure":"success"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:u==="fail"?"font-semibold":"text-muted-foreground",children:"Fail"}),e.jsx(A,{id:"payment-mode",checked:u==="success",onCheckedChange:s=>y(s?"success":"fail"),"data-testid":"switch-payment-mode"}),e.jsx("span",{className:u==="success"?"font-semibold":"text-muted-foreground",children:"Success"})]})]})]})]}),e.jsx("div",{children:e.jsxs(C,{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-6",children:"Your Details"}),e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(N,{htmlFor:"name",children:"Full Name"}),e.jsx(P,{id:"name",value:x,onChange:s=>g(s.target.value),required:!0,"data-testid":"input-name"})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"email",children:"Email"}),e.jsx(P,{id:"email",type:"email",value:m,onChange:s=>v(s.target.value),required:!0,"data-testid":"input-email"})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"phone",children:"Phone Number"}),e.jsx(P,{id:"phone",type:"tel",value:f,onChange:s=>b(s.target.value),required:!0,"data-testid":"input-phone"})]}),e.jsx(T,{type:"submit",className:"w-full",size:"lg",disabled:p.isPending,"data-testid":"button-confirm-booking",children:p.isPending?"Processing...":e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Confirm Booking"]})})]})]})})]})]})]})}function ve(){return e.jsx(se,{children:e.jsx(le,{})})}export{ve as default};
