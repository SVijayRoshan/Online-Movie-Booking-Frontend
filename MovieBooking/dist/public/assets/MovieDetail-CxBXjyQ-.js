import{u as g,r as n,j as e,L as v,f as N}from"./index-YhsNIgvP.js";import{u as b,H as d}from"./Header-CL76FjJX.js";import{B as m,a as w}from"./button-Duyd6bEY.js";import{B as y}from"./badge-BNxsIBJT.js";import{C}from"./card-CfP9Vloi.js";import{S as k}from"./star-DM4Z64dp.js";import{C as E}from"./clock-NVaRpnqF.js";import{C as S}from"./calendar-VtQJu4ZQ.js";function A(){const{id:l}=g(),[r,o]=n.useState(""),{data:t,isLoading:x}=b({queryKey:["/api/movies",l],queryFn:()=>w.getMovie(l),enabled:!!l}),h=n.useMemo(()=>{if(!(t!=null&&t.shows))return[];const s=Array.from(new Set(t.shows.map(a=>a.date))).sort();return s.length>0&&!r&&o(s[0]),s},[t==null?void 0:t.shows,r]),f=n.useMemo(()=>{if(!(t!=null&&t.shows)||!r)return new Map;const s=t.shows.filter(i=>i.date===r),a=new Map;return s.forEach(i=>{a.has(i.theatre)||a.set(i.theatre,[]),a.get(i.theatre).push(i)}),a.forEach(i=>{i.sort((p,j)=>p.time.localeCompare(j.time))}),a},[t==null?void 0:t.shows,r]);if(x)return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(d,{}),e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-96 bg-muted"}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsx("div",{className:"h-8 bg-muted rounded w-1/2 mb-4"}),e.jsx("div",{className:"h-4 bg-muted rounded w-3/4"})]})]})]});if(!t)return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(d,{}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-12 text-center",children:e.jsx("h2",{className:"text-2xl font-bold",children:"Movie not found"})})]});function c(s){try{const a=new URL(s).hostname;return a==="upload.wikimedia.org"||a==="static.wikia.nocookie.net"?`/api/proxy?url=${encodeURIComponent(s)}`:s}catch{return s}}const u=s=>new Date(s).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"});return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(d,{}),e.jsxs("div",{className:"relative h-[50vh] overflow-hidden bg-muted",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background via-background/60 to-transparent z-10"}),e.jsx("img",{src:c(t.posterUrl),alt:t.title,className:"w-full h-full object-cover opacity-30 blur-sm scale-110",onError:s=>{const a=s.target;a.style.display="none"}}),e.jsx("div",{className:"absolute inset-0 z-20 flex items-end",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 pb-8 w-full",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-6 items-start md:items-end",children:[e.jsx("div",{className:"w-48 aspect-[2/3] rounded-lg overflow-hidden shadow-xl flex-shrink-0",children:e.jsx("img",{src:c(t.posterUrl),alt:t.title,className:"w-full h-full object-cover",onError:s=>{const a=s.target;a.src=`data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='600'%3E%3Crect fill='%23334155' width='400' height='600'/%3E%3Ctext fill='%23fff' font-family='Arial' font-size='24' x='50%25' y='50%25' text-anchor='middle' dominant-baseline='middle'%3E${encodeURIComponent(t.title)}%3C/text%3E%3C/svg%3E`},"data-testid":"img-movie-poster"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-3xl md:text-4xl lg:text-5xl font-bold mb-3 font-display","data-testid":"text-movie-title",children:t.title}),e.jsxs("div",{className:"flex flex-wrap gap-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(k,{className:"w-5 h-5 fill-chart-2 text-chart-2"}),e.jsx("span",{className:"font-semibold","data-testid":"text-movie-rating",children:t.rating})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(E,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("span",{"data-testid":"text-movie-duration",children:[t.duration," min"]})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:t.genres.map(s=>e.jsx(y,{variant:"secondary",children:s},s))})]})]})})})]}),e.jsxs("main",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-semibold mb-3",children:"Synopsis"}),e.jsx("p",{className:"text-muted-foreground leading-relaxed","data-testid":"text-synopsis",children:t.synopsis})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-6",children:"Select Showtime"}),e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:h.map(s=>e.jsxs(m,{variant:r===s?"default":"outline",onClick:()=>o(s),className:"flex-shrink-0","data-testid":`button-date-${s}`,children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),u(s)]},s))})}),r&&e.jsx("div",{className:"space-y-6",children:Array.from(f.entries()).map(([s,a])=>e.jsxs(C,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold text-lg mb-4","data-testid":`text-theatre-${s}`,children:s}),e.jsx("div",{className:"flex flex-wrap gap-3",children:a.map(i=>e.jsx(v,{href:`/seats/${i.id}`,children:e.jsx(m,{variant:"outline",className:"min-w-[120px]","data-testid":`button-show-${i.id}`,children:e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-semibold",children:i.time}),e.jsx("div",{className:"text-xs text-muted-foreground",children:N(i.price)})]})})},i.id))})]},s))})]})]})]})}export{A as default};
